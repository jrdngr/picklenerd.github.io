<!DOCTYPE html>
<html>

<head>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
        picklenerd
    </title>

    

<link id="darkly" class="stylesheet" rel="stylesheet"
    href="https:&#x2F;&#x2F;picklenerd.github.io&#x2F;darkly.css" />


    <!-- This script must follow css -->
    
    <script type="text/javascript" src="https:&#x2F;&#x2F;picklenerd.github.io&#x2F;js&#x2F;zulma_switchcss.js"></script>
    <script>
        switch_css.init("https://picklenerd.github.io");
    </script>
    

    

    
    <script defer type="text/javascript" src="https:&#x2F;&#x2F;picklenerd.github.io&#x2F;elasticlunr.min.js"></script>
    <script defer type="text/javascript" src="https:&#x2F;&#x2F;picklenerd.github.io&#x2F;search_index.en.js"></script>
    

    
    

    <noscript>
        <style>
            .navbar-menu {
                display: block;
            }

            .js-only {
                display: none;
            }
        </style>
    </noscript>
    
</head>

<body>
    
    
<!-- START NAV -->


    

<header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                
                <span class="navbar-burger burger" data-target="navbarMenu">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </div>
            <div id="navbarMenu" class="navbar-menu">
                <div class="navbar-end">
                    
                    
                    
                    
                    <a itemprop="url"
                        class="navbar-item "
                        href="https:&#x2F;&#x2F;picklenerd.github.io&#x2F;tags">
                        <span itemprop="name">Tags
                        </span>
                    </a>
                    
                    

                    
                    <div class="navbar-item search-container js-only">
                        <input class="input" id="search" type="search" placeholder="Search">

                        <div class="search-results box">
                            <div class="search-results__items"></div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </nav>
</header>


    

<!-- END NAV -->
<main>
    <section class="container">
        <div class="columns is-desktop">
            <div class="column is-10-desktop is-offset-1-desktop">
                <article itemscope itemtype="http://schema.org/BlogPosting">
                    <div class="card article">
                        <div class="card-content">
                            
<header>
    <div class="has-text-centered">
        <a href="https://picklenerd.github.io/learned-rust/">
            <p class="title article-title">Learning Rust 10: Learned Rust
            </p>
        </a>
        <div class="tags has-addons level-item">
            <span class="tag is-rounded">2017-08-21</span>
                       
            <span class="tag is-rounded">
<svg class="i-clock" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round"
    stroke-linejoin="round" stroke-width="6.25%">
    <circle cx="16" cy="16" r="14" />
    <path d="M16 8 L16 16 20 20" />
</svg>
<span>&nbsp;4 minute read</span>
</span>
        </div>
    </div>
</header>

                            <div itemprop="articleBody" class="content article-body">
                                <p>I took a break from this for a few days.  After having the brilliant idea to rip my systems apart after rebuilding them for the 4th time, I had the even more brilliant idea to undo all of that ripping and go back to when it still compiled.  At some point, I'll have to write something new instead of writing the same thing over and over.</p>
<p>So here I am, two months after deciding to tackle Rust and port over my main project.  I'm feeling pretty confident with Rust at this point, and it has basically poisoned every other part of my life.  My Java code at work is changing, I check the subreddit and forums multiple times every day, and I can't even open Unity anymore without feeling like I'm in the wrong place.</p>
<p>I still want to dump Piston, but I think it's the wrong time.  I'd like to start my dive into graphics programming with Vulkan (I know, shut up) but I need a laptop that supports it first and I'm not getting one until I can buy a Surface Book 2.  So maybe never.</p>
<p>Other than that, I'm going to keep chugging along with my plans.  First, I need to tackle the grid manager's usability.  It works ok but my creature code is awkward and annoying to write.  I'm probably going to go back to an enum of standard actions that I'll return in a vector rather than having the creatures directly manipulate the grid.  They'll probably still have access to it in case I want them to do something wacky to each other, but most of their behavior should be simpler to write.</p>
<p>For example, here's my current plant code:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">plant_action</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">grid_manager</span><span style="color:#c0c5ce;">: &amp;</span><span style="color:#b48ead;">mut</span><span style="color:#c0c5ce;"> GridManager, (</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">): (</span><span style="color:#b48ead;">u32</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">u32</span><span style="color:#c0c5ce;">)) {
    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">utils::random_percentage(</span><span style="color:#d08770;">95.0</span><span style="color:#c0c5ce;">) {
         grid_manager.</span><span style="color:#96b5b4;">add_to_queue</span><span style="color:#c0c5ce;">(x, y, </span><span style="color:#d08770;">LAYER</span><span style="color:#c0c5ce;">);
    } </span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">{
        </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> new_cell_coordinates = (</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);
        </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> set_new_cell = </span><span style="color:#d08770;">false</span><span style="color:#c0c5ce;">;
        {
            </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> neighborhood = grid_manager.</span><span style="color:#96b5b4;">get_neighborhood_of_type</span><span style="color:#c0c5ce;">((x, y), OrganismType::Empty);
            </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> neighborhood.</span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">() &gt; </span><span style="color:#d08770;">0 </span><span style="color:#c0c5ce;">{
                new_cell_coordinates = utils::random_element(neighborhood.</span><span style="color:#96b5b4;">as_slice</span><span style="color:#c0c5ce;">()).</span><span style="color:#d08770;">1.</span><span style="color:#96b5b4;">borrow</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">get_position</span><span style="color:#c0c5ce;">();
                set_new_cell = </span><span style="color:#d08770;">true</span><span style="color:#c0c5ce;">;
            }
        }
        
        </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> set_new_cell {
            grid_manager.</span><span style="color:#96b5b4;">set</span><span style="color:#c0c5ce;">(new_cell_coordinates.</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, new_cell_coordinates.</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#96b5b4;">new_plant</span><span style="color:#c0c5ce;">());
            grid_manager.</span><span style="color:#96b5b4;">add_to_queue</span><span style="color:#c0c5ce;">(x, y, </span><span style="color:#d08770;">LAYER</span><span style="color:#c0c5ce;">);
        }
    }
}
</span></code></pre>
<p>I have this problem where getting a neighborhood takes an immutable reference to the manager, so I have to drop the reference before I can set the cell.  Then I do some other really awful things to compensate.  I didn't really think about this when I wrote it since I was at peak burnout.  I just wanted it to compile and look pretty when I ran it.</p>
<p>Another thing that bugs me is this fake dynamic dispatch thing that I did.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">act</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">grid_manager</span><span style="color:#c0c5ce;">: &amp;</span><span style="color:#b48ead;">mut</span><span style="color:#c0c5ce;"> GridManager, (</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">layer</span><span style="color:#c0c5ce;">): (</span><span style="color:#b48ead;">u32</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">u32</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">u32</span><span style="color:#c0c5ce;">)) {
    </span><span style="color:#b48ead;">let mut</span><span style="color:#c0c5ce;"> cell_type = None;
    </span><span style="color:#b48ead;">if let </span><span style="color:#c0c5ce;">Some(cell) = grid_manager.</span><span style="color:#96b5b4;">get</span><span style="color:#c0c5ce;">(x, y).</span><span style="color:#96b5b4;">borrow_mut</span><span style="color:#c0c5ce;">().</span><span style="color:#96b5b4;">get_layer</span><span style="color:#c0c5ce;">(layer) {
        cell_type = Some(cell.organism_type);
    }

    </span><span style="color:#b48ead;">if let </span><span style="color:#c0c5ce;">Some(id) = cell_type {
        </span><span style="color:#b48ead;">match</span><span style="color:#c0c5ce;"> id {
            OrganismType::Plant =&gt; plant::plant_action(grid_manager, (x, y)),
            OrganismType::Cow   =&gt; cow::cow_action(grid_manager, (x, y)),
            _                   =&gt; {},
        }
    }
}
</span></code></pre>
<p>After reading about static and dynamic dispatch, I ended up with this system rather than trait objects with their own act method because I wanted the performance.  Once I actually thought about it, I decided that this is probably just a slower version of regular dynamic dispatch.  Refactoring it into a trait object is kind of a pain so this is a pretty low priority, but it's still annoying and will be increasingly annoying as I add more creatures.</p>
<p>Once creature writing is cleaned up, I'll write some more creatures that each have a few numerical properties that influence their behavior, then add a rudimentary system of evolution that modifies those properties.  Hopefully, this will produce some interesting results.</p>
<p>Finally, I'll have to step back from coding and do some serious design work.  I need to figure out how the final evoluton system will actually work.  My main task will be to design an energy system that balances utility vs cost.  Every property that a creature has might have an associated energy ratio that alters its energy cost depending on its value.  So a creature might move more quickly, but it's going to lose more energy in the process.  If the property bump is worth the extra energy, it should be more likely to survive.  If I want the idea to be that simple and still produce interesting results, I'm going to have to be clever with the properties.  Or maybe that system won't work at all and I'll have to do something entirely different.</p>
<p>And this concludes my little Learning Rust blog series.  This is obviously just a development blog at this point, as the learning pace has slowed down from &quot;holy shit what is happening!&quot; to &quot;this is a thing that I use.&quot;</p>
<p>I'll end with the amazing(ly stupid) lesson I learned tonight.  <code>unwrap</code> is a trap!  <code>if let</code> your <code>Option</code>s.</p>
<p>Thank you and goodnight!</p>

                            </div>
                        </div>
                        
                        
<footer class="card-footer">
    <div class="article-footer">
        <div class="columns is-multiline">
            <div class="column is-12">
                <p>
                    Published
                    

<time datetime="2017-08-21">
    2017-08-21
</time>


                    


                    


                    

and tagged

<a href="https://picklenerd.github.io/tags/learning-rust/">
    <span class="tag is-link">learning-rust </span>
</a>




                </p>
            </div>
            <div class="column">
                <a class="button is-pulled-right is-info" href="/">Back Home</a>
            </div>
        </div>
    </div>
</footer>

                        
                    </div>
                </article>
            </div>
        </div>
    </section>
</main>

    
    

<footer class="footer js-only">
    <div class="columns">
        <div class="column">
            <div class="content is-flex">
                <div class="theme-select-container">
                    Theme:
                    <select id="theme-select">
                        
                        
                        
                        
                        
                        <option value="default">default</option>
                        
                        
                        
                        
                        
                        
                        <option selected="selected" value="darkly">darkly</option>
                        
                        
                        
                        
                        
                        
                        <option value="flatly">flatly</option>
                        
                        
                        
                        
                        
                        
                        <option value="pulse">pulse</option>
                        
                        
                        
                        
                        
                        
                        <option value="simplex">simplex</option>
                        
                        
                        
                        
                        
                        
                        <option value="lux">lux</option>
                        
                        
                        
                        
                        
                        
                        <option value="slate">slate</option>
                        
                        
                        
                        
                        
                        
                        <option value="solar">solar</option>
                        
                        
                        
                        
                        
                        
                        <option value="superhero">superhero</option>
                        
                        
                    </select>
                </div>
            </div>
        </div>
    </div>
</footer>


    

    <script type="text/javascript" src="https:&#x2F;&#x2F;picklenerd.github.io&#x2F;js&#x2F;zulma_navbar.js"></script>

    
    <script type="text/javascript" src="https:&#x2F;&#x2F;picklenerd.github.io&#x2F;js&#x2F;zulma_search.js"></script>
    

    
</body>

</html>